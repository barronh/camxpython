<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pair CAMx with TropOMI NO2 &#8212; CAMx Examples Unversioned documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <script src="../../_static/documentation_options.js?v=f23e73c1"></script>
    <script src="../../_static/doctools.js?v=fd6eb6e6"></script>
    <script src="../../_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Making CAMx Maps" href="../maps/index.html" />
    <link rel="prev" title="Simple OMI" href="run_satellite_01_simpleomi.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-satellite-run-satellite-02-tropomiak-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code.</p>
</div>
<section class="sphx-glr-example-title" id="pair-camx-with-tropomi-no2">
<span id="sphx-glr-auto-examples-satellite-run-satellite-02-tropomiak-py"></span><h1>Pair CAMx with TropOMI NO2<a class="headerlink" href="#pair-camx-with-tropomi-no2" title="Link to this heading">¶</a></h1>
<p>This example pairs CAMx 3D data with TropOMI NO2 columns using the CMAQ
Satellite Processors (cmaqsatproc). This includes (1) downloading TropOMI data
from NASA’s Distribution and Active Archive Centers (DAAC), (2) regridding
TropOMI to the CAMx grid, (3) subseting CAMx to just overpass times, (4)
filtering CAMx to valid retrieval pixels/layers, and (5) applying the CAMx
a priori shape to the TropOMI retrieval.</p>
<p><em>Reminder</em>: You must have already activated your python environment.</p>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># General settings</span>
<span class="n">satname</span> <span class="o">=</span> <span class="s1">&#39;TropOMINO2&#39;</span>  <span class="c1"># or TropOMIHCHO, VIIRS_AERDB, ...</span>
<span class="n">date</span> <span class="o">=</span> <span class="s1">&#39;2019-06-10&#39;</span>  <span class="c1"># Doing just one day... as a surrogate.</span>
<span class="n">GDNAM</span> <span class="o">=</span> <span class="s1">&#39;36CAMX1&#39;</span>  <span class="c1"># Using Lambert Conic Conformal 36-km grid</span>
<span class="n">gdpath</span> <span class="o">=</span> <span class="s1">&#39;../../camx/GRIDDESC&#39;</span>  <span class="c1"># Definition of a grid</span>
<span class="n">figpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;outputs/CAMx_</span><span class="si">{</span><span class="n">satname</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">GDNAM</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">.png&#39;</span>
</pre></div>
</div>
</section>
<section id="imports-and-folders">
<h2>Imports and Folders<a class="headerlink" href="#imports-and-folders" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cmaqsatproc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">csp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pycno</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;outputs&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Define input paths</span>
<span class="n">sdate</span> <span class="o">=</span> <span class="s1">&#39;2016&#39;</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">:]</span>  <span class="c1"># pair 2019 satellite with 2016 model...</span>
<span class="n">cpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;../../camx/outputs/CAMx.v7.32.36.12.</span><span class="si">{</span><span class="n">sdate</span><span class="si">}</span><span class="s1">.3D.avrg.grd01.nc&#39;</span>
<span class="c1"># If you used camx.tar.gz for inputs, update the met folder to metss</span>
<span class="n">mpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;../../camx/met/camx.3d.36km.</span><span class="si">{</span><span class="n">sdate</span><span class="si">}</span><span class="s1">.nc&#39;</span>

<span class="c1"># Define outputpaths</span>
<span class="n">l3spath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;outputs/</span><span class="si">{</span><span class="n">satname</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">GDNAM</span><span class="si">}</span><span class="s1">.nc&#39;</span>
<span class="n">l3mpath</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;outputs/CAMx_</span><span class="si">{</span><span class="n">satname</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">GDNAM</span><span class="si">}</span><span class="s1">.nc&#39;</span>
</pre></div>
</div>
</section>
<section id="satellite-to-cmaq-camx-grid">
<h2>Satellite to CMAQ/CAMx Grid<a class="headerlink" href="#satellite-to-cmaq-camx-grid" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get a CMAQ/CAMx grid definition</span>
<span class="n">cg</span> <span class="o">=</span> <span class="n">csp</span><span class="o">.</span><span class="n">open_griddesc</span><span class="p">(</span><span class="n">GDNAM</span><span class="p">,</span> <span class="n">gdpath</span><span class="o">=</span><span class="n">gdpath</span><span class="p">)</span>

<span class="c1"># Get the Satellite Reader object</span>
<span class="n">satreader</span> <span class="o">=</span> <span class="n">csp</span><span class="o">.</span><span class="n">reader_dict</span><span class="p">[</span><span class="n">satname</span><span class="p">]</span>

<span class="c1"># Download input files</span>
<span class="n">dests</span> <span class="o">=</span> <span class="n">satreader</span><span class="o">.</span><span class="n">cmr_download</span><span class="p">(</span>
    <span class="n">temporal</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">T17:00:00Z/</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">T23:59:59Z&#39;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">cg</span><span class="o">.</span><span class="n">csp</span><span class="o">.</span><span class="n">bbox</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Use CMAQ grid definition and date to drive cmr query</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">satreader</span><span class="o">.</span><span class="n">paths_to_level3</span><span class="p">(</span>
    <span class="n">dests</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">cg</span><span class="o">.</span><span class="n">csp</span><span class="o">.</span><span class="n">geodf</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">cg</span><span class="o">.</span><span class="n">csp</span><span class="o">.</span><span class="n">bbox</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">9</span>
<span class="p">)</span>
<span class="n">l3</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">l3spath</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>{&#39;concept_id&#39;: &#39;C2089270961-GES_DISC&#39;, &#39;page_size&#39;: &#39;1000&#39;, &#39;pretty&#39;: &#39;false&#39;, &#39;temporal&#39;: &#39;2019-06-10T17:00:00Z/2019-06-10T23:59:59Z&#39;, &#39;bounding_box&#39;: &#39;-132.237011,18.856103,-54.624370,52.880721&#39;}
4 links
data.gesdisc.earthdata.nasa.gov/data/S5P_TROPOMI_Level2/S5P_L2__NO2____HiR.2/2019/161/S5P_RPRO_L2__NO2____20190610T170352_20190610T184522_08588_03_020400_20221105T173209.nc
defaults [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;averaging_kernel&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;]
griddims [&#39;ROW&#39;, &#39;COL&#39;]
dimsets {(&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;): [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;], (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;): [&#39;averaging_kernel&#39;]}
Making geometry
Geometry has 136075 rows (2.2s)
Making overlay
Overlay has 151928 rows (1.9s)
Adding weights
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;)
 - Making dataframe
   - Dataframe has 136075 rows
 - Adding intx geometry
   - Weighted inputs has 151928 rows (0.1s)
 - Weighting
   - Weighted outputs has 4587 rows (0.0s)
 - Adding attributes
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;)
 - Making dataframe
   - Dataframe has 4626550 rows
 - Adding intx geometry
   - Unstacking [&#39;layer&#39;]
   - Weighted inputs has 151928 rows (1.3s)
 - Weighting
/work/ROMO/users/bhenders/SESARMTraining/py312/lib64/python3.12/site-packages/cmaqsatproc/readers/core.py:461: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  ngdf = ngdf.stack(notgeodims)
   - Weighted outputs has 155958 rows (0.1s)
 - Adding attributes
data.gesdisc.earthdata.nasa.gov/data/S5P_TROPOMI_Level2/S5P_L2__NO2____HiR.2/2019/161/S5P_RPRO_L2__NO2____20190610T184522_20190610T202652_08589_03_020400_20221105T173313.nc
defaults [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;averaging_kernel&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;]
griddims [&#39;ROW&#39;, &#39;COL&#39;]
dimsets {(&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;): [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;], (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;): [&#39;averaging_kernel&#39;]}
Making geometry
Geometry has 155871 rows (2.8s)
Making overlay
Overlay has 191171 rows (2.2s)
Adding weights
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;)
 - Making dataframe
   - Dataframe has 155871 rows
 - Adding intx geometry
   - Weighted inputs has 191171 rows (0.1s)
 - Weighting
   - Weighted outputs has 5964 rows (0.0s)
 - Adding attributes
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;)
 - Making dataframe
   - Dataframe has 5299614 rows
 - Adding intx geometry
   - Unstacking [&#39;layer&#39;]
   - Weighted inputs has 191171 rows (1.4s)
 - Weighting
/work/ROMO/users/bhenders/SESARMTraining/py312/lib64/python3.12/site-packages/cmaqsatproc/readers/core.py:461: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  ngdf = ngdf.stack(notgeodims)
   - Weighted outputs has 202776 rows (0.1s)
 - Adding attributes
data.gesdisc.earthdata.nasa.gov/data/S5P_TROPOMI_Level2/S5P_L2__NO2____HiR.2/2019/161/S5P_RPRO_L2__NO2____20190610T202652_20190610T220822_08590_03_020400_20221105T173358.nc
defaults [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;averaging_kernel&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;]
griddims [&#39;ROW&#39;, &#39;COL&#39;]
dimsets {(&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;): [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;], (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;): [&#39;averaging_kernel&#39;]}
Making geometry
Geometry has 112140 rows (1.9s)
Making overlay
Overlay has 124190 rows (1.4s)
Adding weights
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;)
 - Making dataframe
   - Dataframe has 112140 rows
 - Adding intx geometry
   - Weighted inputs has 124190 rows (0.1s)
 - Weighting
   - Weighted outputs has 3379 rows (0.0s)
 - Adding attributes
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;)
 - Making dataframe
   - Dataframe has 3812760 rows
 - Adding intx geometry
   - Unstacking [&#39;layer&#39;]
   - Weighted inputs has 124190 rows (1.0s)
 - Weighting
/work/ROMO/users/bhenders/SESARMTraining/py312/lib64/python3.12/site-packages/cmaqsatproc/readers/core.py:461: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  ngdf = ngdf.stack(notgeodims)
   - Weighted outputs has 114886 rows (0.0s)
 - Adding attributes
data.gesdisc.earthdata.nasa.gov/data/S5P_TROPOMI_Level2/S5P_L2__NO2____HiR.2/2019/161/S5P_RPRO_L2__NO2____20190610T220822_20190610T234951_08591_03_020400_20221105T173846.nc
defaults [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;averaging_kernel&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;]
griddims [&#39;ROW&#39;, &#39;COL&#39;]
dimsets {(&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;): [&#39;air_mass_factor_total&#39;, &#39;air_mass_factor_troposphere&#39;, &#39;nitrogendioxide_tropospheric_column&#39;, &#39;nitrogendioxide_total_column&#39;, &#39;tm5_tropopause_layer_index&#39;, &#39;surface_pressure&#39;], (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;): [&#39;averaging_kernel&#39;]}
Making geometry
Geometry has 31 rows (0.2s)
Making overlay
Overlay has 0 rows (0.0s)
Adding weights
/work/ROMO/users/bhenders/SESARMTraining/py312/lib64/python3.12/site-packages/cmaqsatproc/readers/core.py:284: UserWarning: All areas are zero, which likely means that geometries were points. Reverting to equal weights.
  warnings.warn(
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;)
 - Making dataframe
   - Dataframe has 31 rows
 - Adding intx geometry
   - Weighted inputs has 0 rows (0.0s)
 - Weighting
   - Weighted outputs has 0 rows (0.0s)
 - Adding attributes
Working on (&#39;time&#39;, &#39;scanline&#39;, &#39;ground_pixel&#39;, &#39;layer&#39;)
 - Making dataframe
   - Dataframe has 1054 rows
 - Adding intx geometry
   - Unstacking [&#39;layer&#39;]
   - Weighted inputs has 0 rows (0.0s)
 - Weighting
/work/ROMO/users/bhenders/SESARMTraining/py312/lib64/python3.12/site-packages/cmaqsatproc/readers/core.py:461: FutureWarning: The previous implementation of stack is deprecated and will be removed in a future version of pandas. See the What&#39;s New notes for pandas 2.1.0 for details. Specify future_stack=True to adopt the new implementation and silence this warning.
  ngdf = ngdf.stack(notgeodims)
   - Weighted outputs has 0 rows (0.0s)
 - Adding attributes
</pre></div>
</div>
</section>
<section id="cmaq-camx-to-satellite">
<h2>CMAQ/CAMx to Satellite<a class="headerlink" href="#cmaq-camx-to-satellite" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># reopen satellite l3 file</span>
<span class="n">l3</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">l3spath</span><span class="p">)</span>

<span class="c1"># Open a CMAQ 3D CONC file (NO2) and 3d met file (pressure, z, temperature, humiditiy)</span>
<span class="n">cf</span> <span class="o">=</span> <span class="n">csp</span><span class="o">.</span><span class="n">open_ioapi</span><span class="p">(</span><span class="n">cpath</span><span class="p">)</span>
<span class="n">mkeys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;temperature&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">]</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">csp</span><span class="o">.</span><span class="n">open_ioapi</span><span class="p">(</span><span class="n">mpath</span><span class="p">)[</span><span class="n">mkeys</span><span class="p">]</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">TSTEP</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">TSTEP</span><span class="p">)</span>

<span class="c1"># Reorganize like CMAQ for cmaqsatproc</span>
<span class="n">qf</span> <span class="o">=</span> <span class="n">mf</span><span class="p">[</span><span class="n">mkeys</span><span class="p">]</span>
<span class="n">qf</span><span class="p">[</span><span class="s1">&#39;PRES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qf</span><span class="p">[</span><span class="s1">&#39;pressure&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">100.</span>
<span class="n">qf</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cf</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span> <span class="n">cf</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cf</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span>

<span class="c1"># Create satellite according to CMAQ, and CMAQ according to satellite</span>
<span class="n">overf</span> <span class="o">=</span> <span class="n">satreader</span><span class="o">.</span><span class="n">cmaq_process</span><span class="p">(</span><span class="n">qf</span><span class="p">,</span> <span class="n">l3</span><span class="p">)</span>
<span class="n">overf</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">l3mpath</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="make-a-plot-comparison">
<h2>Make a Plot Comparison<a class="headerlink" href="#make-a-plot-comparison" title="Link to this heading">¶</a></h2>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">l3mpath</span><span class="p">)</span>
<span class="n">sf</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">l3spath</span><span class="p">)</span>

<span class="n">gskw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.033</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.967</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axx</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="n">gskw</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">maxmf</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">ROW</span><span class="o">=</span><span class="mf">39.5</span><span class="p">,</span> <span class="n">COL</span><span class="o">=</span><span class="mf">16.5</span><span class="p">)</span>
<span class="n">ppml</span><span class="p">,</span> <span class="o">=</span> <span class="n">maxmf</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;LAY&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;NO2&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">swl</span><span class="p">,</span> <span class="o">=</span> <span class="n">maxmf</span><span class="p">[</span><span class="s1">&#39;NO2_AK_CMAQ&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;LAY&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">twiny</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">ppml</span><span class="p">,</span> <span class="n">swl</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;NO2 ppb&#39;</span><span class="p">,</span> <span class="s1">&#39;SW&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;NO2 and Sensitivity&#39;</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;(VCDNO2_TOMI_CMAQ - VCDNO2_TOMI_CMAQ.mean()) / VCDNO2_TOMI_CMAQ.mean()&#39;</span><span class="p">)</span>
<span class="n">qm</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="s1">&#39;(VCDNO2_CMAQ - VCDNO2_CMAQ.mean()) / VCDNO2_CMAQ.std()&#39;</span><span class="p">)</span>
<span class="n">Z</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">qm</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">qm</span><span class="o">.</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">pycno</span><span class="o">.</span><span class="n">cno</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span><span class="o">.</span><span class="n">drawstates</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axx</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">figpath</span><span class="p">)</span>
</pre></div>
</div>
<img src="../../_images/sphx_glr_run_satellite_02_tropomiak_001.png" srcset="../../_images/sphx_glr_run_satellite_02_tropomiak_001.png" alt="TSTEP = 2016-06-10, TSTEP = 2016-06-10, NO2 and Sensitivity, longitude = -118.5 [Degrees east], latitude = 3..." class = "sphx-glr-single-img"/><p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 40.021 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-satellite-run-satellite-02-tropomiak-py">
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/2c64e52b6b1f0a744240ebbb36892d76/run_satellite_02_tropomiak.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">run_satellite_02_tropomiak.ipynb</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/fbcf9abfcf012a9f88fe065b9ef2ece6/run_satellite_02_tropomiak.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">run_satellite_02_tropomiak.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-zip docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/02534d61cc39857555848316f0b80b9f/run_satellite_02_tropomiak.zip"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">zipped:</span> <span class="pre">run_satellite_02_tropomiak.zip</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CAMx Examples</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">CAMx Python Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#get-system-ready">Get System Ready</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#gridded-emission-examples">Gridded Emission Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#point-source-emission-examples">Point Source Emission Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#rerun-camx">Rerun CAMx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#model-performance-evaluation">Model Performance Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#satellite-comparison">Satellite Comparison</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#making-camx-maps">Making CAMx Maps</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Examples</a><ul>
  <li><a href="index.html">Satellite Comparison</a><ul>
      <li>Previous: <a href="run_satellite_01_simpleomi.html" title="previous chapter">Simple OMI</a></li>
      <li>Next: <a href="../maps/index.html" title="next chapter">Making CAMx Maps</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2026.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/auto_examples/satellite/run_satellite_02_tropomiak.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>